<div class="app-root">
  <header class="app-header">
    <div class="header-content">
      <div>
        <h1>Image Filter Lab</h1>
        <p class="subtitle">
          上傳一張「參考照片」與「自己的原始照片」，分析差異並輸出接近 iPhone
          「照片」App 的建議調整數值。
        </p>
      </div>
      <button class="theme-toggle-btn" (click)="toggleTheme()"
        [attr.aria-label]="currentTheme === 'dark' ? '切換到明亮模式' : '切換到暗黑模式'">
        <span *ngIf="currentTheme === 'dark'">☀️</span>
        <span *ngIf="currentTheme === 'bright'">🌙</span>
        <span class="theme-label">{{ currentTheme === 'dark' ? '明亮模式' : '暗黑模式' }}</span>
      </button>
    </div>
  </header>

  <main class="app-main">
    <section class="panel panel-upload">
      <div class="upload-column">
        <h2>參考照片</h2>
        <label class="upload-card">
          <input type="file" accept="image/*,.heic,.heif" (change)="onRefFileChange($event)" />
          <span class="upload-placeholder" *ngIf="!refImageUrl">選擇參考照片</span>
          <img *ngIf="refImageUrl" [src]="refImageUrl" class="preview-image" alt="參考照片預覽" />
          <div class="resolution-info" *ngIf="refImageUrl && refOriginalWidth">
            解析度: {{ refOriginalWidth }} x {{ refOriginalHeight }}
          </div>
        </label>
      </div>

      <div class="upload-column">
        <h2>自己的原始照片</h2>
        <label class="upload-card">
          <input type="file" accept="image/*,.heic,.heif" (change)="onMeFileChange($event)" />
          <span class="upload-placeholder" *ngIf="!meImageUrl">選擇自己的照片</span>
          <img *ngIf="meImageUrl" [src]="meImageUrl" class="preview-image" alt="原始照片預覽" />
          <div class="resolution-info" *ngIf="meImageUrl && meOriginalWidth">
            解析度: {{ meOriginalWidth }} x {{ meOriginalHeight }}
          </div>
        </label>
      </div>
    </section>

    <section class="panel panel-actions">
      <button class="primary-btn" [disabled]="!canAnalyze" (click)="analyze()">
        分析差異並產生建議
      </button>
      <span class="status-text">{{ statusText }}</span>
    </section>

    <section class="panel panel-results">
      <h2>建議的 iPhone 調整數值</h2>
      <div class="results-container">
        <p class="hint" *ngIf="!resultsText">
          上傳兩張照片並按下「分析」後，這裡會顯示接近 iPhone
          「照片」App 的建議滑桿數值。
        </p>
        <pre *ngIf="resultsText">{{ resultsText }}</pre>
      </div>
      <button class="secondary-btn" [disabled]="!resultsText" (click)="copyResults()">
        複製建議內容
      </button>
    </section>

    <section class="panel panel-preview">
      <div>
        <h2>模擬調整預覽（網頁端）</h2>
        <p class="hint">
          下方滑桿是「模擬版」，調整的是右側預覽，不會改動原始檔。你可以先在這裡微調，再把數值輸入回
          iPhone。
        </p>
        <button class="secondary-btn" [disabled]="!resultsText" (click)="resetToSuggested()">
          重設為分析建議
        </button>
        <button class="primary-btn export-btn" [disabled]="!meImageUrl" (click)="exportHighRes()">
          匯出原始解析度照片
        </button>
        <div class="sliders-grid">
          <div class="slider-row">
            <label>曝光</label>
            <input type="range" min="-100" max="100" [(ngModel)]="exposure" (input)="onSliderChange()" />
            <span class="slider-value">{{ exposure }}</span>
          </div>
          <div class="slider-row">
            <label>增艷</label>
            <input type="range" min="-100" max="100" [(ngModel)]="brilliance" (input)="onSliderChange()" />
            <span class="slider-value">{{ brilliance }}</span>
          </div>
          <div class="slider-row">
            <label>亮部</label>
            <input type="range" min="-100" max="100" [(ngModel)]="highlights" (input)="onSliderChange()" />
            <span class="slider-value">{{ highlights }}</span>
          </div>
          <div class="slider-row">
            <label>陰影</label>
            <input type="range" min="-100" max="100" [(ngModel)]="shadows" (input)="onSliderChange()" />
            <span class="slider-value">{{ shadows }}</span>
          </div>
          <div class="slider-row">
            <label>對比</label>
            <input type="range" min="-100" max="100" [(ngModel)]="contrast" (input)="onSliderChange()" />
            <span class="slider-value">{{ contrast }}</span>
          </div>
          <div class="slider-row">
            <label>亮度</label>
            <input type="range" min="-100" max="100" [(ngModel)]="brightness" (input)="onSliderChange()" />
            <span class="slider-value">{{ brightness }}</span>
          </div>
          <div class="slider-row">
            <label>黑點</label>
            <input type="range" min="-100" max="100" [(ngModel)]="blackPoint" (input)="onSliderChange()" />
            <span class="slider-value">{{ blackPoint }}</span>
          </div>
          <div class="slider-row">
            <label>飽和度</label>
            <input type="range" min="-100" max="100" [(ngModel)]="saturation" (input)="onSliderChange()" />
            <span class="slider-value">{{ saturation }}</span>
          </div>
          <div class="slider-row">
            <label>自然飽和度</label>
            <input type="range" min="-100" max="100" [(ngModel)]="vibrance" (input)="onSliderChange()" />
            <span class="slider-value">{{ vibrance }}</span>
          </div>
          <div class="slider-row">
            <label>色溫</label>
            <input type="range" min="-100" max="100" [(ngModel)]="warmth" (input)="onSliderChange()" />
            <span class="slider-value">{{ warmth }}</span>
          </div>
          <div class="slider-row">
            <label>色調</label>
            <input type="range" min="-100" max="100" [(ngModel)]="tint" (input)="onSliderChange()" />
            <span class="slider-value">{{ tint }}</span>
          </div>
          <div class="slider-row">
            <label>清晰度</label>
            <input type="range" min="-100" max="100" [(ngModel)]="clarity" (input)="onSliderChange()" />
            <span class="slider-value">{{ clarity }}</span>
          </div>
          <div class="slider-row">
            <label>畫質</label>
            <input type="range" min="-100" max="100" [(ngModel)]="definition" (input)="onSliderChange()" />
            <span class="slider-value">{{ definition }}</span>
          </div>
          <div class="slider-row">
            <label>降低雜點</label>
            <input type="range" min="-100" max="100" [(ngModel)]="noiseReduction" (input)="onSliderChange()" />
            <span class="slider-value">{{ noiseReduction }}</span>
          </div>
        </div>
      </div>

      <div class="preview-canvas-wrapper">
        <canvas #previewCanvas></canvas>
        <p class="preview-hint" *ngIf="!meImageUrl">
          上傳「自己的原始照片」後，這裡會顯示可以被模擬調整的預覽。
        </p>
      </div>
    </section>
  </main>

  <canvas #refCanvas class="hidden-canvas"></canvas>
  <canvas #meCanvas class="hidden-canvas"></canvas>

  <footer class="app-footer">
    <p>
      所有圖片只在你的瀏覽器本機處理，不會上傳到伺服器。結果只是接近 iPhone
      「照片」App 的估算值，實際呈現會依裝置與版本略有不同。
    </p>
    <p>Version {{ appVersion }}</p>
  </footer>
</div>